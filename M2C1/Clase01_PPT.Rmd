---
title: "Herramientas para el Big Data - Clase 01"
subtitle: "Diplomado Big Data para Políticas Públicas"
author: "Pablo Aguirre Hormann"
date: "03/07/2020"
output: 
  ioslides_presentation:
    widescreen: true
    #smaller: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE, 
  message = FALSE, 
  warning = FALSE,
  error = FALSE,
  fig.align = 'center',
  out.width='60%')
```

```{r, include=FALSE}
library(readxl)
library(readxl)
library(tidyverse)
library(tidytext)
library(wordcloud)
library(patchwork)
library(countdown)
library(flair)
```

# Logística del curso

## Algunos acuerdos

- Cámaras abiertas cuando sea posible (y si el internet lo permite)
- Micrófonos cerrados 
  * Chat de Zoom 
  * Habrán espacios para intervenciones
- PPT se subirá a webcursos después de cada clase
- Bloques de 45 minutos con *breaks* de 15 minutos entre cada bloque

## Información general (i)

- Un módulo (6 clases) con dos partes (3 cada una)
- Tres clases conmigo
    * viernes 3, sábado 4, y viernes 24
- *Office hours* (Zoom) 
    * lunes 6, 13, 20 y 27 de 18:00 a 19:30 

## Información general (ii)

- Ayudantías
    * Miércoles 15 y Miércoles 29
- Web curso para preguntas fuera de horario de clases
- **Aprender haciendo** 
  * Ejercicios, tareas
- Dedicación de tiempo

## Nos presentamos

- Pablo Aguirre Hörmann - pjaguirreh@gmail.com
  * Ing. Agrónomo (UC) y Master of Public Policy (U. of Chicago)
  * Análisis e Inteligencia de Negocios - Superintendencia del Medio Ambiente
  
- Victor Caquilpan Parra (*ayudante*) - victor.caquilpan@gmail.com
  * Ing. RRNN (UChile)
  * IoT (*internet de las cosas*) - Superintendencia del Medio Ambiente
  * Ex alumno del diplomado y próximamente Master of Machine Learning (U. of Adelaide)

## Ahora ustedes (i)

```{r, echo = FALSE, out.width='80%'}
datos_alumnos <- read_excel("datos/DatosAlumnos.xlsx")

genero <- datos_alumnos %>% 
  group_by(Género) %>% 
  tally(sort = TRUE) %>% 
  ggplot(aes(x = Género, y = n, fill = Género, label = n)) +
  geom_col() +
  geom_text(nudge_y = 0.7, size = 3.5) +
  labs(x = NULL, y = NULL) +
  theme_minimal() +
  theme(legend.position = "none")

sector <- datos_alumnos %>% 
  group_by(Sector) %>% 
  tally(sort = TRUE) %>% 
  ggplot(aes(x = reorder(Sector, n), y = n, fill = Sector, label = n)) +
  geom_col() +
  coord_flip() +
  geom_text(nudge_y = 0.7, size = 3.5) +
  labs(x = NULL, y = NULL) +
  theme_minimal() +
  theme(legend.position = "none")

area <- datos_alumnos %>% 
  group_by(`Área pregrado`) %>% 
  tally(sort = TRUE) %>% 
  ggplot(aes(x = reorder(`Área pregrado`, n), y = n, fill = `Área pregrado`, label = n)) +
  geom_col() +
  geom_text(nudge_y = 0.15, size = 3.5) +
  labs(x = NULL, y = NULL) +
  coord_flip() +
  theme_minimal() +
  theme(legend.position = "none")

region <- datos_alumnos %>% 
  mutate(Region = case_when(
    Region == "Metropolitana" ~ "RM",
    TRUE ~ "Otras"
  )) %>% 
  group_by(Region) %>% 
  tally(sort = TRUE) %>% 
  ggplot(aes(x = Region, y = n, fill = Region, label = n)) +
  geom_col() +
  geom_text(nudge_y = 0.7, size = 3.5) +
  labs(x = NULL, y = NULL) +
  theme_minimal() +
  theme(legend.position = "none")

(genero | sector) / (area | region)
```

## Ahora ustedes (ii)

```{r, echo=FALSE, out.width='70%'}
#set.seed(2)
#pal <- brewer.pal(7, "RdBu")
#datos_alumnos %>% 
#  mutate(Expectativas = str_squish(Expectativas)) %>% 
#  unnest_tokens(palabra, Expectativas) %>% 
#  filter(!palabra %in% c("de", "en", "y", "para", "la", "a", "que", "quiere", "las", "con", "hay", "le",
#                         "el", "los", "tienen", "del", "no", "se", "su", "área", "trabaja", "como", "está",
#                         "hace", "hacer", "interesa", "mucho", "10", "13", "1300", "2017", "pero", "al", "años",
#                         "día", "condes", "ella", "cosas", "ver", "puede", "esa", "este", "esta", "lo", "más",
#                         "cplt", "esto", "gente", "lenguaje", "temas")) %>% 
#  count(palabra, sort = TRUE) %>%
#  with(wordcloud::wordcloud(
#      palabra,
#      n,
#      max.words = 80,
#      random.order = FALSE,
#      rot.per = 0,
#      colors = pal,
#      fixed.asp = FALSE
#      ))
knitr::include_graphics("Imagenes/WordCloud.PNG")
```

## ¿Qué veremos hoy?

1. Introducción
2. Repaso (muy) breve del curso online
3. Visualización de datos
    * Datos COVID-19 Chile

# Qué, Por qué y Cómo de este curso

## ¿Qué? (i)

- R
- Manejo de datos
- Visualización de datos
- **Comunicar/Reportar** (R Markdown)
  * Potencial de la herramienta: https://tinyurl.com/y9dlg6kb 

## ¿Qué? (ii)

```{r, out.width='80%',  echo = FALSE, out.width='750px'}
knitr::include_graphics("Imagenes/ProcesoDS.png")
```

## Ejemplos

- Análisis exploratorio
- Análisis estadístico
- Reportes

```{r, echo = FALSE, out.width='1000px'}
knitr::include_graphics("Imagenes/EjAnalisis.PNG")
```

## Y mucho más - https://coronavirus.mat.uc.cl/

```{r, echo = FALSE}
knitr::include_url('https://coronavirus.mat.uc.cl/')
```

## ¿Por qué?

- Análisis/Investigación reproducible
- Control/Flexibilidad

## Reproducibilidad (i)

**Objetivo: realizar un reporte basado en datos de [Datos Públicos](http://datos.gob.cl/)**

<div style="float: left; width: 50%;">

**<span style="color:red">SIN PROGRAMACIÓN</span>**

1. Ingresar a la web y descargar datos
2. Limpiar datos en *MS Excel*
3. Analizar datos en *Stata*
4. Escribir documento en *MS Word*

</div>

<div style="float: right; width: 50%;">

**<span style="color:green">CON PROGRAMACIÓN</span>**

1. Crear una carpeta específica para el proyecto/tarea
    * `datos`
    * `gráficos`
    * `resultados`
2. Descargar datos desde `R`
3. Limpiar datos en `R`
4. Analizar datos en `R`
5. Escribir documento en `R Markdown`

</div>

## Reproducibilidad (ii)

**Seis meses después quieres repetir la tarea (o un/a coleg@)**

<div style="float: left; width: 50%;">

**<span style="color:red">SIN PROGRAMACIÓN</span>**

1. Recordar que se hizo
2. Ingresar a la web y descargar datos
3. Limpiar datos en MS Excel y esperar no haberse olvidado de nada
3. Analizar datos en Stata
4. Escribir documento en MS Word

</div>

<div style="float: right; width: 50%;">

**<span style="color:green">CON PROGRAMACIÓN</span>**

1. Re-correr el código

</div>

## ¿Cómo?

- Aprender haciendo
  * Demostración - Ejercicio
  * Tódo código que se muestre estará disponible
- **RStudio Cloud**

## ¿Tienes instalado R/RStudio en tu computador?

```{r, echo=FALSE}
knitr::include_url("https://www.mentimeter.com/s/83c4d13873a002145dcbe78bb3f9484a/ab9686dc9b5a/edit")
```

## RStudio Cloud - https://rstudio.cloud

```{r, echo = FALSE}
knitr::include_url('https://rstudio.cloud/')
```

# Otras puertas que tocar

## Fuentes valiosas de información (i)

```{r, echo = FALSE, out.width='450px'}
knitr::include_graphics("Imagenes/FuentesInformacion.PNG")
```

## Fuentes valiosas de información (ii)

```{r, echo = FALSE, out.width='950px'}
knitr::include_graphics("Imagenes/GoogleCode.PNG")
```

## Fuentes valiosas de información (iii)

```{r, echo = FALSE, out.width='1000px'}
knitr::include_graphics("Imagenes/QuoraEjemplos.PNG")
```

## Fuentes valiosas de información (iv)

```{r, echo = FALSE, out.width='600px'}
knitr::include_graphics("Imagenes/Libros.PNG")
```

- https://r4ds.had.co.nz/ | https://es.r4ds.hadley.nz/
- http://faculty.marshall.usc.edu/gareth-james/ISL/

# Repaso de algunos conceptos

## Ya deberían tener **algo** de experiencia en `R` | Introducción a R para CS

- Introducción a `R` y RStudio
- Funciones y librerías (paquetes)
- Estructura de datos en `R`
- Importar/Exportar datos
- **Manipulación de datos**
- **Visualización de datos**

## ¿En qué módulo del curso online vas? | Selecciona el último que tengas totalmente completo

```{r, echo=FALSE}
knitr::include_url("https://www.mentimeter.com/s/83c4d13873a002145dcbe78bb3f9484a/ab9686dc9b5a/edit")
```

## Última parte del curso online

- Librerías de transformación/manejo/visualización de datos (`Tidyverse`) - https://www.tidyverse.org/
  * `readr` - cargar datos
  * `tidyr` - lograr **tidy** data 
  * `dplyr` - lenguaje (verbos) de manipulación de datos
  * `ggplot2` - visualización
  * `%>%` - "encadenar" código
  
- funcion(datos, instrucciones)
  * `filter(censo, region == "RM")`
  * `select(censo, sexo, edad, region, ingresos)`

## Imprime resultado del código | pero no guarda

```{r, echo=FALSE}
library(readr)
```

```{r}
read_csv("datos/datos_mundo.csv")
```

## Guarda resultado del código | pero no imprime

```{r}
datos_mundo <- read_csv("datos/datos_mundo.csv")
```

## Guarda e imprime el resultado del código (i)

```{r}
datos_mundo <- read_csv("datos/datos_mundo.csv")
datos_mundo
```

## Guarda e imprime el resultado del código (ii)

```{r}
(datos_mundo <- read_csv("datos/datos_mundo.csv"))
```

## Mala práctica

```{r, eval = FALSE}
library(readr)
library(dplyr)
library(ggplot2) 
datos_mundo <- read_csv("datos/datos_mundo.csv")
ggplot(filter(datos_mundo, anio == 2007), aes(x = ExpVida, y = pob)) + geom_point()
```

## Buena práctica

```{r, eval = FALSE}
# Cargar paquetes
library(readr)
library(dplyr)
library(ggplot2) 

# Cargar datos
datos_mundo <- read_csv("datos/datos_mundo.csv")

# Crear subset con datos del año 2007
datos_mundo_select <- datos_mundo %>% 
  filter(anio == 2007)

# Gráfico de ExpVida vs pob
ggplot(datos_mundo_select, aes(x = ExpVida, y = pob)) + 
  geom_point()
```

## Además de google...

No se aburran de usar `?nombrefunción`. Ej: `?ggplot`

```{r, echo=FALSE, out.width='500px'}
knitr::include_graphics("Imagenes/Help.PNG")
```


# Suficiente bla bla...

## A programar

```{r, echo = FALSE, out.width='500px'}
knitr::include_graphics("Imagenes/tenor.gif")
```

## Ejercicio (i) {.smaller}

- Cargar paquetes/librerías

```{r}
library(readr)
library(dplyr)
library(ggplot2) 
```

- Cargar datos
```{r}
datos_mundo <- read_csv("datos/datos_mundo.csv")
```

- Filtrar datos

```{r}
datos_mundo_select <- datos_mundo %>% 
  filter(anio == 2007)
```

- Generar gráfico

```{r, eval=FALSE}
ggplot(datos_mundo_select, aes(x = gdpPercap, y = pob)) +
  geom_point()
```

## Ejercicio (ii) 

```{r, echo = FALSE, out.width='80%'}
ggplot(datos_mundo_select, aes(x = gdpPercap, y = pob)) +
  geom_point()
```

## Ejercicio (iii) {.smaller}

```{r grafej, include=FALSE}
datos_mundo_select <- datos_mundo %>% 
  filter(anio == 2002)

ggplot(datos_mundo_select, aes(x = gdpPercap, y = ExpVida)) +
  geom_point()
```

```{r, echo = FALSE}
decorate("grafej") %>%
  mask("2002") %>%
  mask("gdpPercap") %>%
  mask("ExpVida")
```

## Ejercicio (iv) {.smaller}

RStudio Cloud >> UAI-BDPP-2020-M2 >> Clase01 >> **`1.1.PrimerEjercicioRepaso.R`**

```{r, echo = FALSE}
knitr::include_url('https://rstudio.cloud/')
```

## Ejercicio (v) 

```{r, echo = FALSE}
knitr::include_url("https://apps.garrickadenbuie.com/countdown/")
```

## Respuesta {.smaller}

```{r, echo = FALSE}
decorate('grafej') %>% 
  flair('2002', background = 'Aquamarine') %>% 
  flair('ExpVida', background = 'Aquamarine') %>% 
  flair('gdpPercap', background = 'Aquamarine')
```

# Break

## Break

```{r, echo = FALSE}
#countdown_fullscreen(10)
knitr::include_url("https://apps.garrickadenbuie.com/countdown/")
```

# Demo - Visualizar Datos COVID-19 

## Gráfico COVID-19 {.smaller}

```{r, echo = FALSE}
library(readr)
datos_covid <- read_csv("datos/covid_datos_region.csv")
```

```{r graf0, out.width='80%', echo = FALSE}
ggplot(datos_covid, aes(x = fecha, y = casos_covid_pob)) +
  geom_line(aes(col = region), size = 1) +
  facet_wrap(vars(region)) +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(title = "Evolución casos COVID-19 en Chile por región",
       subtitle = "La región de Tarapacá y Metropolitana lideran la tabla",
       x = NULL,
       y = "Casos por cada 10.000 habitantes")
```

## Visualizar | ¿Qué queremos lograr?

- Mostrar datos 
  * y no mentir con estos
- Contar una historia 
  * ¿causalidad? ¿patrones? ¿puntos de interés?
- Transmitir información y convencer
- Figuras que complementen texto 
  * pero que también puedan sustentarse solas

## Visualizar | Lógica de `ggplot2`

```{r, echo = FALSE, out.width='600px'}
knitr::include_graphics("Imagenes/CapasGgplot.png")
```

## Visualizar | Forma general

```{r, eval = FALSE}
library(ggplot2)
ggplot(datos, aes(x = var1, y = var2)) +
  geom_XXX(...) +
  otros(...)
```

- `geom_point()`
- `geom_line()`
- `geom_xxxx()`
- `facet`
- `theme`

## Datos COVID-19

RStudio Cloud >> UAI-BDPP-2020-M2 >> Clase01 >> **`1.2.GraficoCoronavirus.R`**

```{r, echo = FALSE}
knitr::include_url('https://rstudio.cloud/')
```

## Datos COVID-19 | Cargar datos {.smaller}

```{r}
library(readr)
(datos_covid <- read_csv("datos/covid_datos_region.csv"))
```

<font size="2"> Datos creados a partir de API generada por *@pachamaltese* (https://github.com/pachamaltese) para DATA UC (https://coronavirus.mat.uc.cl/)</font>

## Datos COVID-19 | Examinar datos (i) {.smaller}

```{r}
glimpse(datos_covid)
```

## Datos COVID-19 | Examinar datos (ii) {.smaller}

```{r}
summary(datos_covid)
```

## Gráfico base {.smaller}

```{r graf1, include=FALSE}
ggplot(datos_covid, aes(x = fecha, y = casos_covid_pob))
```

```{r echo = FALSE}
decorate('graf1')  %>% 
  flair_funs() %>% 
  flair_args(background = "pink") %>% 
  flair_input_vals(background = "Aquamarine") %>% 
  flair('datos_covid', background = "orange")
```

## Agregar `geom` de puntos {.smaller}

```{r graf2, include = FALSE}
ggplot(datos_covid, aes(x = fecha, y = casos_covid_pob)) +
  geom_point()
```

```{r, echo = FALSE}
decorate('graf2') %>% 
  flair('geom_point')
```

## Podemos también cambiar el color, forma, y tamaño de los puntos {.smaller}

```{r graf3, include = FALSE}
ggplot(datos_covid, aes(x = fecha, y = casos_covid_pob)) +
  geom_point(col = "red", size = 2, shape = 3)
```

```{r, echo = FALSE}
decorate('graf3') %>% 
  flair('col', background = "pink") %>% 
  flair('size', background = "pink") %>% 
  flair('shape', background = "pink") %>% 
  flair('"red"', background = "Aquamarine") %>% 
  flair('2', background = "Aquamarine") %>% 
  flair('3', background = "Aquamarine")
```

## Podría ser también un `geom` de lineas | Pero algo se ve mal {.smaller}

```{r graf4, include = FALSE}
ggplot(datos_covid, aes(x = fecha, y = casos_covid_pob)) +
  geom_line()
```

```{r, echo = FALSE}
decorate('graf4') %>% 
  flair('geom_line')
```

## Darle más información/instrucciones al gráfico

- Aesthetics
  * Group
  * Color
  * Size
  * Shape
  
- Faceting
  * Gráficos más pequeños que representan *subsets* de los datos

## Cada linea representa una región (i) {.smaller}

```{r, echo = FALSE}
decorate('graf4') %>% 
  flair('geom_line')
```

## Cada linea representa una región (ii) {.smaller}

```{r graf4b, include = FALSE}
ggplot(datos_covid, aes(x = fecha, y = casos_covid_pob, group = region)) +
  geom_line()
```

```{r, echo = FALSE}
decorate('graf4b') %>% 
  flair('group', background = "pink") %>% 
  flair('region', background = "Aquamarine")
```

## Cada linea representa una región (iii) {.smaller}

```{r graf5, include = FALSE}
ggplot(datos_covid, aes(x = fecha, y = casos_covid_pob, col = region)) +
  geom_line()
```

```{r, echo = FALSE}
decorate('graf5') %>% 
  flair('col', background = "pink") %>% 
  flair('region', background = "Aquamarine")
```

## Lo que se defina dentro de `aes` en `ggplot()` afectará todos los `geom` {.smaller}

```{r graf6, include = FALSE}
ggplot(datos_covid, aes(x = fecha, y = casos_covid_pob, col = region)) +
  geom_line() +
  geom_point()
```

```{r, echo = FALSE}
decorate('graf6') %>% 
  flair('geom_point')
```

## Si no queremos que esto pase, podemos definir `aes` para `geom` especifícos {.smaller}

```{r graf7, include=FALSE}
ggplot(datos_covid, aes(x = fecha, y = casos_covid_pob)) +
  geom_line(aes(col = region)) +
  geom_point(size = 0.5)
```

```{r, echo = FALSE}
decorate('graf7') %>% 
  flair('(aes') %>% 
  flair('col', background = "pink") %>% 
  flair('region', background = "AquaMarine")
```

# Ejercicio

## Ejercicio (i) {.smaller}

```{r, eval = FALSE}
# Creen un gráfico de puntos (geom_point) con "fecha" en el eje X y el número  habitantes (pcr_acum_pob) 
# de PCR cada 10.000 en el eje Y

ggplot(datos_covid, aes(x = ***, y = ***)) +
  geom_***()
```

```{r, eval = FALSE}
# Creen un gráfico de lineas (geom_line) con "fecha" en el eje X y el número de PCR  
# cada 10.000 habitantes (pcr_acum_pob) en el eje Y. Agregue un argumento de color 
# (col) que permita diferenciar las lineas según region

ggplot(datos_covid, aes(x = ***, y = ***, *** = region)) +
  geom_***() 
```

```{r, eval = FALSE}
# Agregue al gráfico anterior puntos (geom_point) y deje el tamaño (size) igual a 1.

ggplot(datos_covid, aes(x = fecha, y = pcr_acum_pob, col = region)) +
  geom_line() +
  geom_***(*** = ***)
```

## Ejercicio (ii)

RStudio Cloud >> UAI-BDPP-2020-M2 >> Clase01 >> **`1.3.SegundoEjercicioGraficosI.R`**

```{r, echo = FALSE}
knitr::include_url('https://rstudio.cloud/')
```

## Ejercicio (iii)

```{r, echo = FALSE}
knitr::include_url("https://apps.garrickadenbuie.com/countdown/")
```

## Respuesta {.smaller}

```{r, eval = FALSE}
# Creen un gráfico de puntos (geom_point) con "fecha" en el eje X y el número  habitantes (pcr_acum_pob) 
# de PCR cada 10.000 en el eje Y

ggplot(datos_covid, aes(x = fecha, y = pcr_acum_pob)) +
  geom_point()
```

```{r, eval = FALSE}
# Creen un gráfico de lineas (geom_line) con "fecha" en el eje X y el número de PCR  
# cada 10.000 habitantes (pcr_acum_pob) en el eje Y. Agregue un argumento de color 
# (col) que permita diferenciar las lineas según region

ggplot(datos_covid, aes(x = fecha, y = pcr_acum_pob, col = region)) +
  geom_line() 
```

```{r, eval = FALSE}
# Agregue al gráfico anterior puntos (geom_point) y deje el tamaño (size) igual a 1.

ggplot(datos_covid, aes(x = fecha, y = pcr_acum_pob, col = region)) +
  geom_line() +
  geom_point(size = 1)
```

# Break

## Break

```{r, echo = FALSE}
#countdown_fullscreen(10)
knitr::include_url("https://apps.garrickadenbuie.com/countdown/")
```

## Darle más información/instrucciones al gráfico

- Aesthetics
  * Group
  * Color
  * Size
  * Shape
  
- Faceting
  * Gráficos más pequeños que representan *subsets* de los datos

## Separemos cada linea en su propio panel (i) {.smaller}

```{r graf8, include=FALSE}
ggplot(datos_covid, aes(x = fecha, y = casos_covid_pob)) +
  geom_line(aes(col = region), size = 1) +
  facet_wrap(vars(region ))
```

```{r, echo = FALSE}
decorate('graf8') %>% 
  flair('vars') %>% 
  flair('facet_wrap') %>% 
  flair('region ', background = "Aquamarine")
```

## Separemos cada linea en su propio panel (ii) {.smaller}

```{r graf8b, include=FALSE}
ggplot(datos_covid, aes(x = fecha, y = casos_covid_pob)) +
  geom_line(aes(col = region), size = 1) +
  facet_wrap(vars(region), scales = "free_y")
```

```{r, echo = FALSE}
decorate('graf8b') %>% 
  flair('scales', background = "pink") %>% 
  flair('"free_y"', background = "Aquamarine")
```

## Separemos cada linea en su propio panel (iii) {.smaller}

```{r graf8c, include=FALSE}
ggplot(datos_covid, aes(x = fecha, y = casos_covid_pob)) +
  geom_line(aes(col = region), size = 1) +
  facet_wrap(vars(region), ncol = 5)
```

```{r, echo = FALSE}
decorate('graf8c') %>% 
  flair('ncol', background = "pink") %>% 
  flair('5', background = "Aquamarine")
```

## Fondo blanco pareciera quedar mejor (i) {.smaller}

```{r graf9, include=FALSE}
ggplot(datos_covid, aes(x = fecha, y = casos_covid_pob)) +
  geom_line(aes(col = region), size = 1) +
  facet_wrap(vars(region)) +
  theme_bw()
```

```{r, echo=FALSE}
decorate('graf9') %>% 
  flair('theme_bw')
```

## Fondo blanco pareciera quedar mejor (ii) {.smaller}

```{r graf9b, include=FALSE}
ggplot(datos_covid, aes(x = fecha, y = casos_covid_pob)) +
  geom_line(aes(col = region), size = 1) +
  facet_wrap(vars(region)) +
  theme_minimal()
```

```{r, echo=FALSE}
decorate('graf9b') %>% 
  flair('theme_minimal')
```

## La leyenda pareciera no ser de mucha ayuda {.smaller}

```{r graf10, include=FALSE}
ggplot(datos_covid, aes(x = fecha, y = casos_covid_pob)) +
  geom_line(aes(col = region), size = 1) +
  facet_wrap(vars(region)) +
  theme_minimal() +
  theme(legend.position = "none")
```

```{r, echo=FALSE}
decorate('graf10') %>% 
  flair('theme(') %>% 
  flair('legend.position', background = "pink") %>% 
  flair('"none"', background = "Aquamarine")
```

## "Themes" prefabricados | https://ggplot2.tidyverse.org/reference/ggtheme.html

```{r, echo = FALSE}
knitr::include_url("https://ggplot2.tidyverse.org/reference/ggtheme.html")
```

## Cómo modificar detalles de nuestos gráficos

```{r, echo = FALSE, out.width='700px'}
knitr::include_graphics("Imagenes/ggplot2Elements.jpg")
```

## Títulos/Ejes como detalles finales {.smaller}

```{r graf11, include=FALSE}
ggplot(datos_covid, aes(x = fecha, y = casos_covid_pob)) +
  geom_line(aes(col = region), size = 1) +
  facet_wrap(vars(region)) + theme_minimal() +
  theme(legend.position = "none") +
  labs(title = "Evolución casos COVID-19 en Chile por región",
       subtitle = "La región de Tarapacá y Metropolitana lideran la tabla",
       x = NULL, y = "Casos por cada 10.000 habitantes")
```

```{r, echo = FALSE}
decorate('graf11') %>% 
  flair('labs(title = "Evolución casos COVID-19 en Chile por región",') %>% 
  flair('subtitle = "La región de Tarapacá y Metropolitana lideran la tabla",') %>% 
  flair('x = NULL, y = "Casos por cada 10.000 habitantes")')
```

# Ejercicio

## Ejercicio (i) {.smaller}

```{r, eval = FALSE}
# Guarde en el objeto "p" un gráfico de lineas con las variables fecha en el eje X y pcr_acum_pob en el eje Y.
# Distinga cada linea por región con un color distinto y que todas tengan tamaño 2.

p <- ggplot(***, aes(x = ***, y = ***)) + 
  geom_line(***(*** = region), size = ***)
```

```{r, eval = FALSE}
# Separe cada linea en su propio subgrafico (facet por región), dejando la distribución de todos los gráficos
# en 3 columnas. Aplique también un "theme" para dejar fondo de todos los gráficos en blanco y elimine la leyenda

p <- p + 
  ***_wrap(vars(***), ncol= ***) + 
  ***_minimal() + 
  theme(***.position = "none")
```

```{r, eval = FALSE}
# Agregue títulos y subtítulos al gráfico y modifique texto de ejes X e Y.

p +
  labs(*** = ***,
       subtitle = ***,
       x = ***, 
       y = ***)
```

## Ejercicio (ii) {.smaller}

RStudio Cloud >> UAI-BDPP-2020-M2 >> Clase01 >> **`1.4.TercerEjercicioGraficosII.R`**

```{r, echo = FALSE}
knitr::include_url('https://rstudio.cloud/')
```

## Ejercicio (iii)

```{r, echo = FALSE}
knitr::include_url("https://apps.garrickadenbuie.com/countdown/")
```

## Respuesta {.smaller}

```{r, eval = FALSE}
# Guarde en el objeto "p" un gráfico de lineas con las variables fecha en el eje X y pcr_acum_pob en el eje Y.
# Distinga cada linea por región con un color distinto y que todas tengan tamaño 2.
p <- ggplot(datos_covid, aes(x = fecha, y = pcr_acum_pob)) + 
  geom_line(aes(col = region), size = 2)
```

```{r, eval = FALSE}
# Separe cada linea en su propio subgrafico (facet por región), dejando la distribución de todos los gráficos
# en 3 columnas. Aplique también un "theme" para dejar fondo de todos los gráficos en blanco y elimine la leyenda
p <- p + 
  facet_wrap(vars(region), ncol= 3) + 
  theme_minimal() + 
  theme(***.position = "none")
```

```{r, eval = FALSE}
# Agregue títulos y subtítulos al gráfico y modifique texto de ejes X e Y.
p +
  labs(title = "Cualquier título",
       subtitle = "Cualquier subtítulo",
       x = "Cualquier texto", 
       y = "Cualquier texto")
```

# Break

## Break

```{r, echo = FALSE}
#countdown_fullscreen(10)
knitr::include_url("https://apps.garrickadenbuie.com/countdown/")
```

## Otros tipos de gráficos

```{r, echo = FALSE}
covid_ultimodia <- datos_covid %>% 
  group_by(region) %>% 
  filter(row_number() == n())
```

```{r, echo = FALSE}
library(patchwork)

p1 <- ggplot(covid_ultimodia, aes(x = reorder(region, casos_covid_pob), y = casos_covid_pob)) + 
  geom_col(fill = "light blue") +
  theme_minimal() + 
  labs(x = NULL, y = "Casos COVID") +
  coord_flip()

p2 <- ggplot(covid_ultimodia, aes(pcr_acum_pob, log(muertes_covid))) +
  geom_point(size = 3, col = "light blue") + 
  geom_smooth(method = "lm", se = FALSE, col = "black") +
  theme_minimal() + 
  labs(x = "Casos COVID", y = "Log de muertes por COVID")

p3 <- datos_covid %>% 
  ggplot(aes(region, log(casos_covid))) +
  geom_boxplot(fill = "light blue") + 
  labs(x = NULL, y = "Log de Casos COVID") +
  theme_minimal() + 
  coord_flip()
```

```{r, echo = FALSE, fig.height=7, fig.width=9}
p1 | p3 | p2
```

## Gráfico de barras (i) {.smaller}

```{r graf12a, include=FALSE}
ggplot(covid_ultimodia, aes(x = region, y = casos_covid_pob)) + 
  geom_col()
```

```{r, echo = FALSE}
decorate('graf12a') %>% 
  flair('covid_ultimodia', background = "Orange") %>% 
  flair('geom_col') %>% 
  flair('region', background = "Aquamarine") %>% 
  flair('casos_covid_pob', background = "Aquamarine")
```

## Gráfico de barras (ii) {.smaller}

```{r graf12b, include=FALSE}
ggplot(covid_ultimodia, aes(x = reorder(region, casos_covid_pob), y = casos_covid_pob)) + 
  geom_col()
```

```{r, echo = FALSE}
decorate('graf12b') %>% 
  flair('reorder(region, casos_covid_pob)', background = "Aquamarine")
```

## Gráfico de barras (iii) {.smaller}

```{r graf12c, include=FALSE}
ggplot(covid_ultimodia, aes(x = reorder(region, casos_covid_pob), y = casos_covid_pob)) + 
  geom_col(fill = "light blue") +
  theme_minimal() + 
  labs(x = NULL, y = "Casos COVID") +
  coord_flip()
```

```{r, echo = FALSE}
decorate('graf12c') %>% 
  flair('coord_flip') %>% 
  flair('labs') %>% 
  flair('theme_minimal') %>% 
  flair('"light blue"', background = "Aquamarine") %>% 
  flair('fill', background = "pink")
```

## Boxplot (i) {.smaller}

```{r graf13a, include=FALSE}
ggplot(datos_covid, aes(region, casos_covid)) +
  geom_boxplot()
```

```{r, echo = FALSE}
decorate('graf13a') %>% 
  flair('geom_boxplot')
```

## Boxplot (ii) {.smaller}

```{r graf13b, include=FALSE}
datos_covid %>% 
  ggplot(aes(region, log(casos_covid))) +
  geom_boxplot() + 
  theme_minimal()
```

```{r, echo = FALSE}
decorate('graf13b') %>% 
  flair('log(casos_covid)', background = "Aquamarine") %>% 
  flair('theme_minimal')
```

## Boxplot (iii) {.smaller}

```{r graf13c, include=FALSE}
datos_covid %>% 
  ggplot(aes(region, log(casos_covid))) +
  geom_boxplot(fill = "light blue") + 
  theme_minimal() + 
  labs(x = NULL, y = "Log de Casos COVID") +
  coord_flip()
```

```{r, echo = FALSE}
decorate('graf13c') %>% 
  flair('"light blue"', background = "Aquamarine") %>% 
  flair('theme_minimal') %>% 
  flair('labs') %>% 
  flair('coord_flip') %>% 
  flair('fill', background = "pink")
```

## Dispersión y linea de tendencia (i) {.smaller}

```{r graf14a, include=FALSE}
ggplot(covid_ultimodia, aes(pcr_acum_pob, log(muertes_covid))) +
  geom_point(size = 3, col = "light blue")
```

```{r, echo = FALSE}
decorate('graf14a') %>% 
  flair('"light blue"', background = "Aquamarine") %>% 
  flair('3', background = "Aquamarine") %>% 
  flair('geom_point') %>% 
  flair('size', background = "pink") %>% 
  flair('col', background = "pink")
```

## Dispersión y linea de tendencia (ii) {.smaller}

```{r graf14b, include=FALSE}
ggplot(covid_ultimodia, aes(pcr_acum_pob, log(muertes_covid))) +
  geom_point(size = 3, col = "light blue") + 
  geom_smooth() +
  theme_minimal() + 
  labs(x = "Casos COVID", y = "Log de muertes por COVID")
```

```{r, echo = FALSE}
decorate('graf14b') %>% 
  flair('geom_smooth') %>% 
  flair('theme_minimal') %>% 
  flair('labs')
```

## Dispersión y linea de tendencia (iii) {.smaller}

```{r graf14c, include=FALSE}
ggplot(covid_ultimodia, aes(pcr_acum_pob, log(muertes_covid))) +
  geom_point(size = 3, col= "light blue") + 
  geom_smooth(method = "lm", se = FALSE, col = "black") +
  theme_minimal() + 
  labs(x = "Casos COVID", y = "Log de muertes por COVID")
```

```{r, echo = FALSE}
decorate('graf14c') %>% 
  flair('method', background = "pink") %>% 
  flair('se', background = "pink") %>% 
  flair('col ', background = "pink") %>% 
  flair('"lm"', background = "Aquamarine") %>% 
  flair('FALSE', background = "Aquamarine") %>% 
  flair('"black"', background = "Aquamarine")
```

# Ejercicio

## Ejercicio (i) {.smaller}

```{r, eval = FALSE}
# Cree un gráfico de barras region vs pcr_acum_pob. Asegúrese de voltear las coordenadas del gráfico y defina
# el relleno de las barras como rojo ("red").
ggplot(covid_ultimodia, aes(x = region, y = pcr_acum_pob)) + 
  geom_col(*** = "red") +
  theme_minimal() + 
  labs(x = NULL, y = "N° PCR acumulados") +
  ***_flip()

# Repita lo recién hecho pero además ajuste el orden en que se muestran las barras
ggplot(covid_ultimodia, aes(x = ***(region, pcr_acum_pob), y = pcr_acum_pob)) + 
  geom_col(*** = "red") +
  theme_minimal() + 
  labs(x = NULL, y = "N° PCR acumulados") +
  ***_flip()

# Cree un gráfico boxplot y defina el relleno como café ("brown"). Ajuste también la transparencia (alpha) de los
# boxplot a 0.5
datos_covid %>% 
  ggplot(aes(region, log(casos_covid))) +
  geom_boxplot(fill = ***, *** = 0.5) + 
  theme_minimal() + 
  labs(x = NULL, y = "Log de Casos COVID") +
  coord_flip()
```

## Ejercicio (ii) {.smaller}

RStudio Cloud >> UAI-BDPP-2020-M2 >> Clase01 >> **`1.5.CuartoEjercicioGraficosIV.R`**

```{r, echo = FALSE}
knitr::include_url('https://rstudio.cloud/')
```

## Ejercicio (iii) {.smaller}

```{r, echo = FALSE}
knitr::include_url("https://apps.garrickadenbuie.com/countdown/")
```

## Respuesta (i) {.smaller}

```{r}
# Cree un gráfico de barras region vs pcr_acum_pob. Asegúrese de voltear las coordenadas del gráfico y defina
# el relleno de las barras como rojo ("red").
ggplot(covid_ultimodia, aes(x = region, y = pcr_acum_pob)) + 
  geom_col(fill = "red") +
  theme_minimal() + 
  labs(x = NULL, y = "N° PCR acumulados") +
  coord_flip()
```

## Respuesta (ii) {.smaller}

```{r}

# Repita lo recién hecho pero además ajuste el orden en que se muestran las barras
ggplot(covid_ultimodia, aes(x = reorder(region, pcr_acum_pob), y = pcr_acum_pob)) + 
  geom_col(fill = "red") +
  theme_minimal() + 
  labs(x = NULL, y = "N° PCR acumulados") +
  coord_flip()
```

## Respuesta (iii) {.smaller}

```{r}
# Cree un gráfico boxplot y defina el relleno como café ("brown"). Ajuste también la transparencia (alpha) de los
# boxplot a 0.5
datos_covid %>% 
  ggplot(aes(region, log(casos_covid))) +
  geom_boxplot(fill = "brown", alpha = 0.5) + 
  theme_minimal() + 
  labs(x = NULL, y = "Log de Casos COVID") +
  coord_flip()
```

## Muchas más posibilidades | https://www.data-to-viz.com/

```{r, echo = FALSE}
knitr::include_url("https://www.data-to-viz.com/")
```

